<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="漂泊在日帝"><title>AutoLayout笔记 | cookie的部落格</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-101641631-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">AutoLayout笔记</h1><a id="logo" href="/.">cookie的部落格</a><p class="description">这个人不懒，但就是什么都没有留下</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">AutoLayout笔记</h1><div class="post-meta">Jun 10, 2017</div><div class="post-content"><p>参考资料：<br><a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/index.html" target="_blank" rel="external">Apple官方AutoLayout资料</a><br><a href="https://developers.eure.jp/tech/ios_layout_beginners/" target="_blank" rel="external">iOSエンジニア必見！！iOSのレイアウトで押さえておきたいこと【総集編】</a></p>
<h3 id="约束调试"><a href="#约束调试" class="headerlink" title="约束调试"></a>约束调试</h3><p>当系统检测到autolayout冲突时候<br>1 定位冲突的约束<br>2 系统打破一个约束，然后检查是否有冲突，如果有重复之前的步骤<br>3 在consolo中输出冲突以及打破的约束</p>
<p>如果要调试约束的冲突可以add symbolic breakpoint。<br><img src="https://qiita-image-store.s3.amazonaws.com/0/100736/df4e8432-15d7-e4b8-2bcd-888d2425944e.png"></p>
<ul>
<li>在Symbol中输入<strong>UIViewAlertForUnsatisfiableConstraints</strong></li>
<li>Action选择Debugger Command</li>
<li>在Action中输入<strong>expr -l objc++ -O – [[UIWindow keyWindow] _autolayoutTrace]</strong></li>
</ul>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/100736/ca545f64-1214-090d-8038-488b1b0181e5.png"></p>
<p>这样在console中输入命令可以改变UIView的颜色,输入完后按一下运行的三角按钮<br><img src="https://qiita-image-store.s3.amazonaws.com/0/100736/a4f63245-c531-005c-543a-55d57660666a.png"></p>
<h3 id="约束冲突"><a href="#约束冲突" class="headerlink" title="约束冲突"></a>约束冲突</h3><p>如何去修正冲突的约束？<br>首先分析什么情况下容易发生约束冲突<br>1 添加子view的时候<br>设定子view的<strong>translatesAutoresizingMaskIntoConstraints</strong>的值为false，<br>2 提供的空间太小，导致一些view的内容无法正常显示<br>将一些约束的优先级降低（默认是1000，你可以设置为999），如果发生冲突，这些约束优先会被舍弃。尽量不要设定固定的长度或高度。</p>
<h3 id="模糊布局"><a href="#模糊布局" class="headerlink" title="模糊布局"></a>模糊布局</h3><p>含糊不清的layout，具体表现是view可能有多种展示方式。<br>原因主要有两个<br>1 缺少某些约束<br>2 约束发生冲突，冲突的约束优先级相同</p>
<p><a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/ModifyingConstraints.html#//apple_ref/doc/uid/TP40010853-CH29-SW1" target="_blank" rel="external">关于变更约束</a></p>
<p>有四种情况下约束会发生变化<br>1 添加或移除约束<br>2 改变约束的值<br>3 改变约束的优先级<br>4 将view从view层次结构中移除</p>
<p>最好在改变状态的同时改变约束，比如在button的action中改变约束。</p>
<h3 id="约束的推迟更新"><a href="#约束的推迟更新" class="headerlink" title="约束的推迟更新"></a>约束的推迟更新</h3><p>Instead of immediately updating the affected views’ frames, Auto Layout schedules a layout pass for the near future. This deferred pass updates the layout’s constraints and then calculates the frames for all the views in the view hierarchy.</p>
<p>You can schedule your own deferred layout pass by calling the setNeedsLayout method or the setNeedsUpdateConstraints method.</p>
<p>view的frame的更新并不是立即执行的，他会在将来的某个时刻更新layout，重新计算frame。你能够使用<strong>setNeedsLayout</strong>或者<strong>setNeedsUpdateConstraints</strong>去告知系统在未来某个时刻更新layout，并重新计算frame。</p>
<p>layout的传递中包含了两个传递<br>1 update pass：更新必要的约束<br>2 layout pass：更新view的frame的位置</p>
<p><strong>Update Pass：</strong><br>根据view的层次调用<strong>updateViewConstraints</strong>(包括所有的view以及ViewController)</p>
<p><strong>Layout pass：</strong><br>根据视图层次调用VC的<strong>viewWillLayoutSubviews</strong>和view的<strong>layoutSubViews</strong>。默认条件下，<strong>layoutSubView</strong>更新view的frame。你可以重写这个函数来实现一些自定义行为。</p>
<h3 id="批处理更新"><a href="#批处理更新" class="headerlink" title="批处理更新"></a>批处理更新</h3><p>当有大量的约束需要更新时，利用<strong>setNeedsUpdateConstraints</strong>，然后重写<strong>updateViewConstraints</strong>。<br>Note：不要在<strong>updateViewConstraints</strong>中取消约束然后重新定义约束，最好是更新约束的值。</p>
<p><strong>注意：在updateViewConstraints中调用setNeedsUpdateConstraints会造成循环调用</strong></p>
<p>至于重写<strong>viewWillLayoutSubviews</strong>或者<strong>layoutSubView</strong>，注意点比较多。<a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/ModifyingConstraints.html#//apple_ref/doc/uid/TP40010853-CH29-SW1" target="_blank" rel="external">注意要素链接</a></p>
<h3 id="主动更新约束"><a href="#主动更新约束" class="headerlink" title="主动更新约束"></a>主动更新约束</h3><p>因为<strong>setNeedsUpdateConstraints</strong>函数调用后，约束并不是立即更新的所以开发者可以调用<strong>updateConstraintsIfNeed</strong>函数来主动更新约束，但在某个view中调用这个方法后只会对这个view以及其subView中调用过<strong>setNeedsUpdateConstraints</strong>函数的view起作用。不要直接去调用<strong>UpdateConstraints</strong>。</p>
<h3 id="视图的固有内容尺寸"><a href="#视图的固有内容尺寸" class="headerlink" title="视图的固有内容尺寸"></a>视图的固有内容尺寸</h3><p>视图的固有内容尺寸是指，内容的尺寸会根据视图的尺寸以及约束做出调整<br><img src="/images/autolayout1.jpg" alt=""><br><img src="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/Art/intrinsic_content_size_2x.png"><br>上图中compression约束的优先级（750）高于hugging约束的优先级（250）。所以一般情况下拉伸内容的尺寸比压缩内容的尺寸更加的方便。当多个view需要伸缩或缩小时不知道哪个view的尺寸需要优先更新时可以改变他们compressing和hugging的优先级，从而决定哪个view优先扩张。<a href="https://krakendev.io/blog/autolayout-magic-like-harry-potter-but-real" target="_blank" rel="external">资料</a></p>
<h3 id="布局的更新"><a href="#布局的更新" class="headerlink" title="布局的更新"></a>布局的更新</h3><p>不要直接调用<strong>layoutSubview</strong>函数，道理同约束一样。和约束一样调用<strong>layoutIfNeeded</strong>时候，只对调用该方法的view和其subview中调用过<strong>setNeedsLayout</strong>函数的view起作用</p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a href="/2017/07/12/iOS关于复杂View的横屏竖屏UI的对应/" class="pre">iOS关于复杂View的横屏竖屏UI的对应</a><a href="/2017/05/20/RAC简介/" class="next">ReactiveCocoa简介</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Swift-Objective-C/" style="font-size: 15px;">Swift, Objective-C</a> <a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/硬件/" style="font-size: 15px;">硬件</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/游戏/" style="font-size: 15px;">游戏</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/Swift和OC混编Tips-1/">Swift和OC混编Tips-1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/10/Swift和OC混编那点事/">Swift和OC混编--记一次Xcode的提示和高亮失效  </a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/12/iOS关于复杂View的横屏竖屏UI的对应/">iOS关于复杂View的横屏竖屏UI的对应</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/10/重拾AutoLayout/">AutoLayout笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/20/RAC简介/">ReactiveCocoa简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/14/To-the-Moon/">To the Moon</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/05/上班后第一个黄金周/">上班后第一个黄金周</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/07/代码简洁之循环和逻辑简单化/">代码简洁之循环和逻辑简单化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/01/利用AFNetworking自动更新Token/">利用AFNetworking自动更新Token</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/27/Swift面向协议编程/">Swift面向协议编程</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">cookie的部落格.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>